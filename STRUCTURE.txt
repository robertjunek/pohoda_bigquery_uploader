apoteka_veverka/
â”‚
â”œâ”€â”€ ğŸ“‹ KONFIGURACE
â”‚   â”œâ”€â”€ config.json                     # MS SQL, BigQuery, Sentry konfigurace
â”‚   â”œâ”€â”€ veverka.json                    # Google Cloud credentials
â”‚   â””â”€â”€ requirements.txt                # Python zÃ¡vislosti
â”‚
â”œâ”€â”€ ğŸ” SQL DOTAZY
â”‚   â”œâ”€â”€ FA.sql                          # Faktury
â”‚   â”œâ”€â”€ PH.sql                          # Prodejky
â”‚   â”œâ”€â”€ SKPP.sql                        # PÅ™Ã­jemky
â”‚   â””â”€â”€ SKPV.sql                        # VÃ½dejky
â”‚
â”œâ”€â”€ ğŸš€ HLAVNÃ SKRIPTY
â”‚   â”œâ”€â”€ sync_pohoda_to_bigquery.py      # HlavnÃ­ synchronizaÄnÃ­ skript
â”‚   â”œâ”€â”€ setup_config.py                 # Konfigurace MS SQL pÅ™ipojenÃ­
â”‚   â”œâ”€â”€ test_connections.py             # Test pÅ™ipojenÃ­ k databÃ¡zÃ­m
â”‚   â”œâ”€â”€ test_sync.sh                    # TestovacÃ­ spuÅ¡tÄ›nÃ­ (bash)
â”‚   â””â”€â”€ check_status.py                 # Kontrola stavu synchronizace
â”‚
â”œâ”€â”€ ğŸ“– DOKUMENTACE
â”‚   â”œâ”€â”€ README.md                       # KompletnÃ­ dokumentace
â”‚   â”œâ”€â”€ QUICKSTART.md                   # RychlÃ½ start
â”‚   â”œâ”€â”€ ARCHITECTURE.md                 # Diagram architektury
â”‚   â”œâ”€â”€ TODO.txt                        # PÅ™ehled vÅ¡ech souborÅ¯ + TODO
â”‚   â””â”€â”€ STRUCTURE.txt                   # Tento soubor
â”‚
â”œâ”€â”€ ğŸ› ï¸  POMOCNÃ‰ SOUBORY
â”‚   â”œâ”€â”€ Makefile                        # SnadnÃ© ovlÃ¡dÃ¡nÃ­ (make help)
â”‚   â”œâ”€â”€ crontab.example                 # PÅ™Ã­klady cron nastavenÃ­
â”‚   â””â”€â”€ .gitignore                      # Git ignore soubor
â”‚
â”œâ”€â”€ ğŸ“ SLOÅ½KY
â”‚   â””â”€â”€ .venv/                          # Python virtual environment
â”‚
â””â”€â”€ ğŸ“ GENEROVANÃ‰ (pÅ™i bÄ›hu)
    â”œâ”€â”€ sync.log                        # HlavnÃ­ log soubor
    â”œâ”€â”€ sync.log.1, .2, ...             # RotovanÃ© logy
    â””â”€â”€ cron.log                        # Cron vÃ½stup


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PÅ˜EHLED FUNKCÃ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

sync_pohoda_to_bigquery.py
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ PÅ™ipojenÃ­ k MS SQL serveru
âœ“ ZÃ­skÃ¡nÃ­ linked_server a database z tabulky companies
âœ“ NaÄtenÃ­ SQL souborÅ¯ a pÅ™idÃ¡nÃ­ prefixÅ¯ k tabulkÃ¡m
âœ“ StahovÃ¡nÃ­ dat po dÃ¡vkÃ¡ch (5000 zÃ¡znamÅ¯)
âœ“ NahrÃ¡vÃ¡nÃ­ do BigQuery po dÃ¡vkÃ¡ch
âœ“ RotaÄnÃ­ logovÃ¡nÃ­ do souboru
âœ“ Error tracking pÅ™es Sentry.io
âœ“ KompletnÃ­ error handling
âœ“ SprÃ¡vnÃ½ exit code pro cron

setup_config.py
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ InteraktivnÃ­ konfigurace MS SQL pÅ™ipojenÃ­
âœ“ NastavenÃ­ Sentry DSN
âœ“ UloÅ¾enÃ­ do config.json

test_connections.py
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Test MS SQL pÅ™ipojenÃ­
âœ“ Kontrola tabulky companies
âœ“ Test BigQuery pÅ™ipojenÃ­
âœ“ Kontrola datasetu
âœ“ OvÄ›Å™enÃ­ SQL souborÅ¯

test_sync.sh
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Kontrola virtual environment
âœ“ Kontrola konfiguraÄnÃ­ch souborÅ¯
âœ“ SpuÅ¡tÄ›nÃ­ synchronizace
âœ“ ZobrazenÃ­ vÃ½sledku

check_status.py
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ ParsovÃ¡nÃ­ sync.log
âœ“ ZobrazenÃ­ stavu poslednÃ­ synchronizace
âœ“ Seznam zpracovanÃ½ch tabulek
âœ“ Seznam chyb (pokud jsou)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
WORKFLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. INSTALACE (jednorÃ¡zovÄ›)
   â”œâ”€ source .venv/bin/activate
   â””â”€ pip install -r requirements.txt  âœ“ HOTOVO

2. KONFIGURACE (jednorÃ¡zovÄ›)
   â”œâ”€ make config
   â”‚  (nebo: python setup_config.py)
   â””â”€ Zadej MS SQL credentials a Sentry DSN

3. TEST PÅ˜IPOJENÃ
   â”œâ”€ make test-conn
   â””â”€ (nebo: python test_connections.py)

4. TESTOVACÃ SYNCHRONIZACE
   â”œâ”€ make test-sync
   â””â”€ (nebo: ./test_sync.sh)

5. NASTAVENÃ CRON (pro automatiku)
   â”œâ”€ crontab -e
   â””â”€ PÅ™idej: 0 2 * * * cd /home/robert/projekty/apoteka_veverka && .venv/bin/python sync_pohoda_to_bigquery.py >> cron.log 2>&1

6. MONITORING
   â”œâ”€ make status         # Stav poslednÃ­ sync
   â”œâ”€ make logs           # Å½ivÃ© sledovÃ¡nÃ­
   â””â”€ make logs-errors    # Jen chyby


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VELIKOSTI SOUBORÅ®
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

sync_pohoda_to_bigquery.py    16 KB   (hlavnÃ­ skript)
config.json                   ~1 KB   (konfigurace)
veverka.json                  ~2 KB   (credentials)
test_connections.py           ~5 KB   (testy)
check_status.py               ~4 KB   (monitoring)
README.md + dokumentace       ~15 KB  (dokumentace)

Celkem: ~45 KB (bez .venv a logÅ¯)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ZÃVISLOSTI (requirements.txt)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

pyodbc==5.0.1                 # MS SQL pÅ™ipojenÃ­
google-cloud-bigquery==3.14.1 # BigQuery API
pandas==2.1.4                 # Data manipulace
sentry-sdk==1.39.2            # Error tracking
python-dotenv==1.0.0          # Environment variables

+ vÅ¡echny sub-zÃ¡vislosti (google-auth, numpy, atd.)
Celkem ~150 MB v .venv


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BEZPEÄŒNOST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ config.json v .gitignore (obsahuje hesla)
âœ“ veverka.json v .gitignore (Google credentials)
âœ“ sync.log* v .gitignore (mÅ¯Å¾e obsahovat citlivÃ¡ data)
âœ“ Connection timeout (30s)
âœ“ Error tracking pÅ™es Sentry
âœ“ RotaÄnÃ­ logy (max 10 MB Ã— 5)

DÅ®LEÅ½ITÃ‰: Nikdy necommituj config.json a veverka.json do gitu!


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VÃKON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Batch size:          5000 zÃ¡znamÅ¯
Timeout:             30 sekund
Paralelizace:        Ne (sekvenÄnÃ­ zpracovÃ¡nÃ­ tabulek)
Retry logika:        Ne (fail-fast s logovÃ¡nÃ­m do Sentry)

OdhadovanÃ½ Äas:      ZÃ¡visÃ­ na mnoÅ¾stvÃ­ dat
                     ~1-5 minut pro nÄ›kolik tisÃ­c zÃ¡znamÅ¯
                     ~10-30 minut pro statisÃ­ce zÃ¡znamÅ¯
